# Perses Kustomization for MaaS Observability
#
# DEPLOYMENT MODES:
#
# 1. UIPlugin Mode (RECOMMENDED for OpenShift):
#    - Use: ./scripts/install-perses-dashboards.sh
#    - UIPlugin creates Perses in openshift-operators namespace
#    - Only dashboards and datasource are deployed from here
#    - No need for perses-instance.yaml, perses-rbac.yaml, or perses-route.yaml
#
# 2. Standalone Mode (for custom deployments):
#    - Use: kubectl apply -k deployment/components/observability/perses/
#    - Deploys full stack to maas-api namespace
#    - Requires all files including instance, RBAC, route
#    - UIPlugin (perses-uiplugin.yaml) applied separately (cluster-scoped)
#
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: maas-perses
  annotations:
    config.kubernetes.io/local-config: "true"

# NOTE: For UIPlugin mode, Perses runs in openshift-operators
# This namespace is for standalone mode only
namespace: maas-api

resources:
  # Standalone mode: Perses instance and configuration
  - perses-rbac.yaml
  - perses-instance.yaml
  - perses-datasource.yaml
  - perses-route.yaml
  # Both modes: Dashboards (for UIPlugin, apply to openshift-operators instead)
  - dashboards/dashboard-ai-engineer.yaml
  - dashboards/dashboard-platform-admin.yaml
  # UIPlugin (perses-uiplugin.yaml) is cluster-scoped - apply separately:
  #   kubectl apply -f perses-uiplugin.yaml

labels:
  - pairs:
      app.kubernetes.io/managed-by: maas-observability
      app.kubernetes.io/component: perses
    includeSelectors: false

